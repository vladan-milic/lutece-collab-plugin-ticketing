<#include "/admin/plugins/ticketing/include/user_info.html"/>
<#macro ticketHeader tab ticket navigation_next=-1 navigation_previous=-1>
<div class="gru-wrapper">
<div id="customer-panel" class="row ticket-head bg-gru-light">
   <div class="col-xs-8 col-sm-offset-1 col-sm-3">
      <h2>${ticket.userTitle} ${ticket.firstname} ${ticket.lastname}</h2>
      <h2 class="hidden-xs">&nbsp;</h2>
      <div class="visible-xs">
         <p><i class="fa fa-envelope"></i> ${ticket.email!""}</p>
         <#if ticket.fixedPhoneNumber?has_content>
         <p>
            <i class="fa fa-phone" ></i>
            <#if ticket.fixedPhoneNumber?length == 10>
            ${ticket.fixedPhoneNumber[0..1]} ${ticket.fixedPhoneNumber[2..3]} ${ticket.fixedPhoneNumber[4..5]} ${ticket.fixedPhoneNumber[6..7]} ${ticket.fixedPhoneNumber[8..9]}
            <#else>
            ${ticket.fixedPhoneNumber!}
            </#if>
         </p>
         </#if>
         <#if ticket.mobilePhoneNumber?has_content>
         <p>
            <i class="fa fa-mobile" ></i>
            <#if ticket.mobilePhoneNumber?length == 10>
            ${ticket.mobilePhoneNumber[0..1]} ${ticket.mobilePhoneNumber[2..3]} ${ticket.mobilePhoneNumber[4..5]} ${ticket.mobilePhoneNumber[6..7]} ${ticket.mobilePhoneNumber[8..9]}
            <#else>
            ${ticket.mobilePhoneNumber!}
            </#if>
         </p>
         </#if>
      </div>
      <h2>
         <a class="btn btn-border" href="jsp/admin/plugins/ticketing/ManageTickets.jsp?plugin_name=ticketing" >
         <i class="fa fa-arrow-left"></i> #i18n{ticketing.view_ticket_header.labelReturn}
         </a>
         <#if url_poc_gru?? && url_poc_gru?has_content>
         <a class="btn btn-border" href="${url_poc_gru!}" >
         <i class="fa fa-compass"></i> #i18n{ticketing.gru.button.360View}
         </a>
         </#if>
      </h2>
   </div>
   <div class="hidden-xs col-sm-4">
      <p><i class="fa fa-envelope"></i> ${ticket.email!""}</p>
      <#if ticket.fixedPhoneNumber?has_content>
      <p>
         <i class="fa fa-phone" ></i>
         <#if ticket.fixedPhoneNumber?length == 10>
         ${ticket.fixedPhoneNumber[0..1]} ${ticket.fixedPhoneNumber[2..3]} ${ticket.fixedPhoneNumber[4..5]} ${ticket.fixedPhoneNumber[6..7]} ${ticket.fixedPhoneNumber[8..9]}
         <#else>
         ${ticket.fixedPhoneNumber!}
         </#if>
      </p>
      </#if>
      <#if ticket.mobilePhoneNumber?has_content>
      <p>
         <i class="fa fa-mobile" ></i>
         <#if ticket.mobilePhoneNumber?length == 10>
         ${ticket.mobilePhoneNumber[0..1]} ${ticket.mobilePhoneNumber[2..3]} ${ticket.mobilePhoneNumber[4..5]} ${ticket.mobilePhoneNumber[6..7]} ${ticket.mobilePhoneNumber[8..9]}
         <#else>
         ${ticket.mobilePhoneNumber!}
         </#if>
      </p>
      </#if>
      <!-- FIXME -->
      <!--
         <p id="info">Pour me contacter privil&eacute;gier le mail</p>
         -->

      <!-- NAVIGATION -->
      <#if next_ticket ?? || previous_ticket ?? >
      <nav id="item-navigator">
         <ul class="pager">
            <#if previous_ticket ??   >
            <li class="previous">
               <a href="jsp/admin/plugins/ticketing/TicketView.jsp?id=${previous_ticket}" title="#i18n{ticketing.navigation.ticket.view.details.previous.title}">
               <i class="fa fa-arrow-left"></i> #i18n{ticketing.navigation.ticket.view.details.previous}
               </a>
            </li>
            </#if>
            <#if next_ticket ??  >
            <li class="next">
               <a href="jsp/admin/plugins/ticketing/TicketView.jsp?id=${next_ticket}" title="#i18n{ticketing.navigation.ticket.view.details.next.title}">
               #i18n{ticketing.navigation.ticket.view.details.next} <i class="fa fa-arrow-right"></i>
               </a>
            </li>
            </#if>
         </ul>
      </nav>
      </#if>    
      <!-- END NAVIGATION -->

   </div>
   <div class="col-xs-4 col-sm-3" id="info-head-right">
      <#assign textColor="green"/>
      <#if ticket.urgency==1 >
      <#assign textColor="orange"/>
      <#elseif ticket.urgency==2 >
      <#assign textColor="red"/>
      </#if>
      <p data-toggle="tooltip" data-placement="bottom" title="Priorit&eacute; : ${priority!''} / Criticit&eacute; : ${criticality!''}">
         <i class="fa fa-circle text-${textColor} fa-fw"></i> ${ticket.reference!}
      </p>
      <p>
         <#if ticket.state?? >
           <#switch ticket.ticketStatus>
             <#case 0>
               <i class="fa fa-hourglass-half fa-fw"></i>
               <#break>
             <#case 1>
               <i class="fa fa-check fa-fw"></i>
               <#break>
           </#switch>
           ${ticket.state.name}
         </#if>
      </p>
      <#if ticket.assigneeUnit??>
        <p>
          <i class="fa fa-sitemap fa-fw"></i> ${ticket.assigneeUnit.name}
        </p>
      </#if>
      <#if ticket.assigneeUser??>
      	<#assign user=user_factory.create(ticket.assigneeUser.adminUserId)!>
          <#if user?has_content>
          <p class="info_user" data-key-id="${user.idUser}" data-container="body" data-toggle="popover" data-placement="left">
            <#if avatar_available>
            <img class="direct-chat-img" src="servlet/plugins/adminavatar/avatar?id_user=${ticket.assigneeUser.adminUserId}">
            </#if>
            <span class="avatar-label">${ticket.assigneeUser.firstname} ${ticket.assigneeUser.lastname}</span>
            <@info_user user/>
          </p>
         </#if>
      </#if>
   </div>
</div>
</#macro>
