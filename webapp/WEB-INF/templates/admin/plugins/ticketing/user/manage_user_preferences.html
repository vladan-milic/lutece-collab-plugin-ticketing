<script>$(".content-header").hide();</script>
<#include "/admin/util/editor/editor.html" />
<div class="gru-wrapper">
  <div id="customer-panel" class="row ticket-head bg-gru-light">
    <div class="col-xs-12 col-sm-offset-1 col-sm-11">
      <h2>#i18n{ticketing.manage_user_preferences.pageTitle}</h2>
      <h3>#i18n{ticketing.manage_user_preferences.labelTitle}</h3>
      <h2>
        <a class="btn btn-border" href="jsp/admin/plugins/ticketing/ManageTickets.jsp?plugin_name=ticketing" >
          <i class="fa fa-arrow-left"></i> #i18n{ticketing.manage_user_preferences.labelReturn}
        </a>
      </h2>
    </div>
  </div>
  <div id="demand-panel" class="row">
    <div class="col-xs-12 col-sm-12 top">
      <div class="row">
        <div class="col-xs-12 col-sm-offset-1 col-sm-9">
          <@messages infos=infos />
          <@messages errors=errors />
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12 col-sm-offset-1 col-sm-9">
          <form id="" class="form-horizontal" method="post" name="modify_user_preferences" action="jsp/admin/plugins/ticketing/UserPreferences.jsp" enctype="multipart/form-data">
            <div class="form-group">
              <label class="col-xs-12 col-sm-3 control-label">#i18n{ticketing.manage_user_preferences.labelCreationDate} :</label>
              <div class="col-xs-12 col-sm-9">
                <div>
                  <input type="radio" name="creation_date_display" id="check_creation_date_as_counter" value="counter" <#if !creation_date_as_date>checked</#if> />
                  <label for="check_creation_date_as_counter" >
                  &nbsp;#i18n{ticketing.manage_user_preferences.labelCreationDate.counter}
                  </label>
                  ( #i18n{ticketing.manage_user_preferences.labelCreationDate.labelExample} <strong class="lead">0</strong> #i18n{ticketing.commons.unitMinute} )
                </div>
                <div>
                  <input type="radio" name="creation_date_display" id="check_creation_date_as_date" value="date" <#if creation_date_as_date>checked</#if>/>
                  <label for="check_creation_date_as_date" >
                  &nbsp;#i18n{ticketing.manage_user_preferences.labelCreationDate.date}
                  </label>
                  ( #i18n{ticketing.manage_user_preferences.labelCreationDate.labelExample} ${.now?string["dd/MM/yyyy HH:mm"]} )
                  <p class="help-block">#i18n{ticketing.manage_user_preferences.labelCreationDate.help}</p>
                </div>
              </div>
            </div>
            <div class="form-group">
                <label class="col-xs-12 col-sm-3 control-label" for="user_signature">#i18n{ticketing.manage_user_preferences.labelUserSignature}&nbsp;:</label>
                <div class="col-xs-12 col-sm-9">
                    <textarea class="ticketing form-control richtext" id="user_signature" name="user_signature" >${user_signature!''}</textarea>
                    <p class="help-block">#i18n{ticketing.manage_user_preferences.labelUserSignature.help}</p>
                </div>
            </div>
            <div class="form-group">
              <label class="col-xs-12 col-sm-3 control-label">#i18n{ticketing.manage_user_preferences.labelChannels} :</label>
              <div class="col-xs-12 col-sm-9">
                <#list channels_list as channel>
                  <#assign is_selectable = false>
                  <#if selectable_id_channel_list?? && selectable_id_channel_list?has_content>
                    <#list selectable_id_channel_list as selectable_channel_id>
                      <#if "${channel.id}" == "${selectable_channel_id}">
                        <#assign is_selectable = true>
                      </#if>
                    </#list>
                  </#if>
                  <div class="col-xs-12 col-sm-9">
                    <#if is_selectable == true>
                      <input type="checkbox" name="selectable_channels" id="check_${channel.id}" value="${channel.id}" checked/>
                    <#else>
                      <input type="checkbox" name="selectable_channels" id="check_${channel.id}" value="${channel.id}"/>
                    </#if>
                    <label for="check_${channel.id}" name="${channel.label}">
                      <span class="${channel.iconFont}"></span>&nbsp;${channel.label}
                    </label> <br >           
                  </div>
                </#list>
              </div>
            </div>
            <div class="form-group">
              <label class="col-xs-12 col-sm-3 control-label">#i18n{ticketing.manage_user_preferences.labelDefaultChannel} :</label>
              <div class="col-xs-12 col-sm-9">
                <select id="selected_channel" name="selected_channel" class="form-control">
                  <#list channels_list as channel>
                    <#assign is_selectable = false>
                    <#if selectable_id_channel_list?? && selectable_id_channel_list?has_content>
                      <#list selectable_id_channel_list as selectable_channel_id>
                        <#if "${channel.id}" == "${selectable_channel_id}">
                          <#assign is_selectable = true>
                        </#if>
                      </#list>
                    </#if>
                    <#if is_selectable == true>
                      <#if "${channel.id}" == "${preferred_id_channel}">
                        <option selected="selected" value="${channel.id}" >${channel.label}</option>
                      <#else>
                        <option value="${channel.id}" >${channel.label}</option>
                      </#if>
                    </#if>
                  </#list>
                </select>
              </div>
            </div>
            <@actionButtons button1Name="action_modifyUserPreferences" i18nValue1Key="ticketing.manage_user_preferences.button.save" offset=3 />
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<@initEditor />
<script language="javascript">
  $('#selectable_channels').change(function() {
    var selectedChannelId = $("#selected_channel").val();
    $("#selected_channel").empty();
        
    $('#selectable_channels :selected').each(function(){
      if (selectedChannelId == $(this).val()) {
        $("#selected_channel").append('<option selected="selected" value="' + $(this).val() + '">' + $(this).text() + '</option>')
      } else {
        $("#selected_channel").append('<option value="' + $(this).val() + '">' + $(this).text() + '</option>')
      }
    }); 
  });
</script>
<script language="javascript">
  $('input:checkbox[name=selectable_channels]').click(function(){
    $("#selected_channel").empty();
    $('input:checkbox[name=selectable_channels]').each(function(){
      if($(this).is(":checked")) {
        var text = $(this).next('label').attr('name');
        $("#selected_channel").append('<option value="' + $(this).val() + '">' + text + '</option>')
      }
    });
  });  
</script>



