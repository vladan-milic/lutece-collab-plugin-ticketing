<#include "/admin/util/editor/editor.html" />
<div class="gru-wrapper">
  <div id="customer-panel" class="row ticket-head bg-gru-light">
    <div class="col-xs-12 col-sm-offset-1 col-sm-11">
      <h2>#i18n{ticketing.create_ticket.pageTitle}</h2>
      <h3>Mes Pr&eacute;f&eacute;rences</h3>
      <h2>
        <a class="btn btn-border" href="jsp/admin/plugins/ticketing/ManageTickets.jsp?plugin_name=ticketing" >
          <i class="fa fa-arrow-left"></i> Retour
        </a>
      </h2>
    </div>
  </div>
  <div id="demand-panel" class="row">
    <div class="col-xs-12 col-sm-12 top">
      <div class="row">
        <div class="col-xs-12 col-sm-offset-1 col-sm-9">
          <@messages infos=infos />
          <@messages errors=errors />
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12 col-sm-offset-1 col-sm-9">
          <form id="" class="form-horizontal" method="post" name="modify_user_preferences" action="jsp/admin/plugins/ticketing/UserPreferences.jsp" enctype="multipart/form-data">
            <@fieldTextArea i18nLabelKey="ticketing.manage_user_preferences.labelUserSignature" inputName="user_signature" value="${user_signature!''}" i18nHelpBlockKey="ticketing.manage_user_preferences.labelUserSignature.help" cssClass="form-control richtext" />
             <div class="form-group">
               <label class="col-xs-12 col-sm-3 control-label">#i18n{ticketing.manage_user_preferences.labelChannels} :</label>
               <div class="col-xs-12 col-sm-9">
                 <select id="selectable_channels" name="selectable_channels" multiple="multiple" class="form-control">
                   <#list channels_list as channel>
                     <#assign is_selectable = false>
                     <#if selectable_id_channel_list?? && selectable_id_channel_list?has_content>
                       <#list selectable_id_channel_list as selectable_channel_id>
                         <#if "${channel.code}" == "${selectable_channel_id}">
                            <#assign is_selectable = true>
                         </#if>
                       </#list>
                     </#if>
                     <#if is_selectable == true>
                       <option selected="selected" value="${channel.code}" >${channel.name}</option>
                     <#else>
                       <option value="${channel.code}" >${channel.name}</option>
                     </#if>
                   </#list>
                 </select>
               </div>
             </div>
             <div class="form-group">
               <label class="col-xs-12 col-sm-3 control-label">#i18n{ticketing.manage_user_preferences.labelDefaultChannel} :</label>
               <div class="col-xs-12 col-sm-9">
                 <select id="selected_channel" name="selected_channel" class="form-control">
                   <#list channels_list as channel>
                     <#assign is_selectable = false>
                     <#if selectable_id_channel_list?? && selectable_id_channel_list?has_content>
                       <#list selectable_id_channel_list as selectable_channel_id>
                         <#if "${channel.code}" == "${selectable_channel_id}">
                            <#assign is_selectable = true>
                         </#if>
                       </#list>
                     </#if>
                     <#if is_selectable == true>
                       <#if "${channel.code}" == "${preferred_id_channel}">
                         <option selected="selected" value="${channel.code}" >${channel.name}</option>
                       <#else>
                         <option value="${channel.code}" >${channel.name}</option>
                       </#if>
                     </#if>
                   </#list>
                 </select>
               </div>
             </div>
            <@actionButtons button1Name="action_modifyUserPreferences" i18nValue1Key="ticketing.manage_user_preferences.button.save" offset=3 />
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<@initEditor />
<script>
  $( function(){
    $(".content-header").toggle();
  });
</script>
<script language="javascript">
    $('#selectable_channels').change(function() {
        var selectedChannelId = $("#selected_channel").val();
        $("#selected_channel").empty();
        
        $('#selectable_channels :selected').each(function(){
        	if (selectedChannelId == $(this).val()) {
        		$("#selected_channel").append('<option selected="selected" value="' + $(this).val() + '">' + $(this).text() + '</option>')
        	} else {
        	    $("#selected_channel").append('<option value="' + $(this).val() + '">' + $(this).text() + '</option>')
        	}
        });	
    });
</script>



