<#include "/admin/plugins/ticketing/include/user_info.html"/>
<script src="js/plugins/ticketing/user_info.js"></script>
<#if history_information_list?has_content>
  <div id="ticketing-history-panel">
    <div class="panel">
      <#assign defaultUserFrontId=5>
      <#list history_information_list as history_information>
        <p>
          <strong class="text-gru">${history_information.resource_history.creationDate!'Date missing'}</strong> &nbsp;
          <strong>${history_information.resource_history.action.description}</strong>
          <#if resource_history_channel[history_information.resource_history.id?string]?has_content>
            <#assign msgTooltip="#i18n{ticketing.view_ticket_history.channel.used}">
            <span title="${msgTooltip} ${resource_history_channel[history_information.resource_history.id?string].label}" style="float:right;" class="${resource_history_channel[history_information.resource_history.id?string].iconFont}"></span>
          </#if>
        </p>
        <ul class="timeline">
          <li>
            <#if history_information.admin_user_history?exists>
              <#if adminAvatar>
                <#if history_information.admin_user_history.userId?string != "${defaultUserFrontId}">
                 <#if resource_history_user.create(history_information.admin_user_history.userId)?has_content>
                  <a href="sip:${history_information.admin_user_history.email}">
                  	<#assign user1=resource_history_user.create(history_information.admin_user_history.userId)>
                    <em>
                    <img class="info_user fa direct-chat-img" data-key-id="${user1.idUser}" data-container="body" data-toggle="popover" data-placement="right"
                    	src="servlet/plugins/adminavatar/avatar?id_user=${history_information.admin_user_history.userId}">
                    </em>
                  </a>
                  <@info_user user1/>
                  </#if>
                <#else>
                  <img class="fa direct-chat-img" src="servlet/plugins/adminavatar/avatar?id_user=${history_information.admin_user_history.userId}" alt="Avatar" title="Avtar">
                </#if>
              <#else>
                <i class="fa fa-user bg-gru-cat2"></i>
              </#if>
            <#else>
              <i class="fa fa-user-times bg-gru-cat2"></i>
            </#if>
            <div class="timeline-item">
              <h4 class="timeline-header">
                <#if history_information.admin_user_history?exists>
                  <#if history_information.admin_user_history.userId?string != "${defaultUserFrontId}">
                  <#if resource_history_user.create(history_information.admin_user_history.userId)?has_content>
                    <a href="sip:${history_information.admin_user_history.email}">
                    <#assign user2=resource_history_user.create(history_information.admin_user_history.userId)>
                      <em  class="info_user" data-key-id="${user2.idUser}" data-container="body" data-toggle="popover" data-placement="left">
	                    &nbsp; ${history_information.admin_user_history.firstName} ${history_information.admin_user_history.lastName}</em>
	                    </a>
	                    <@info_user user2/>
	                </#if>
                  <#else>
                      <em>&nbsp; ${history_information.admin_user_history.firstName} ${history_information.admin_user_history.lastName}</em>
                  </#if>
                <#else>
                  &nbsp;#i18n{ticketing.view_ticket_history.admin_user_undefined}
                </#if>
              </h4>
              <div class="timeline-body">
                <#list history_information.task_information_list as task_information>
                  ${task_information}
                </#list>
              </div>
            </div>
          </li>
        </ul>
      </#list>
    </div>
  </div>

<#else>
  <div class="alert alert-error">#i18n{ticketing.view_ticket_history.history_empty}</div>
</#if>